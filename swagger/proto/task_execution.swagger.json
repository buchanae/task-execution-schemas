{
  "swagger": "2.0",
  "info": {
    "title": "proto/task_execution.proto",
    "version": "version not set"
  },
  "schemes": [
    "http",
    "https"
  ],
  "consumes": [
    "application/json"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/v1/tasks": {
      "get": {
        "summary": "List tasks.",
        "operationId": "ListTasks",
        "responses": {
          "200": {
            "description": "",
            "schema": {
              "$ref": "#/definitions/tesListTasksResponse"
            }
          }
        },
        "parameters": [
          {
            "name": "project",
            "description": "Filter the task list to include tasks in this project.\n\nOPTIONAL.",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "name_prefix",
            "description": "Filter the list to include tasks where the name matches this prefix.\nIf unspecified, no task name filtering is done.\n\nOPTIONAL.",
            "in": "query",
            "required": false,
            "type": "string"
          },
          {
            "name": "page_size",
            "description": "Number of tasks to return in one page.\nMust be less than 2048. Defaults to 256.\n\nOPTIONAL.",
            "in": "query",
            "required": false,
            "type": "integer",
            "format": "int64"
          },
          {
            "name": "page_token",
            "description": "Page token is used to retrieve the next page of results.\nIf unspecified, returns the first page of results.\nSee ListTasksResponse.next_page_token. OPTIONAL.",
            "in": "query",
            "required": false,
            "type": "string"
          }
        ],
        "tags": [
          "TaskService"
        ]
      },
      "post": {
        "summary": "Create a new task.",
        "operationId": "CreateTask",
        "responses": {
          "200": {
            "description": "",
            "schema": {
              "$ref": "#/definitions/tesTask"
            }
          }
        },
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/tesCreateTaskRequest"
            }
          }
        ],
        "tags": [
          "TaskService"
        ]
      }
    },
    "/v1/tasks/service-info": {
      "get": {
        "summary": "GetServiceInfo provides information about the service,\nsuch as storage details, resource availability, and \nother documentation.",
        "operationId": "GetServiceInfo",
        "responses": {
          "200": {
            "description": "",
            "schema": {
              "$ref": "#/definitions/tesServiceInfo"
            }
          }
        },
        "tags": [
          "TaskService"
        ]
      }
    },
    "/v1/tasks/{id}": {
      "get": {
        "summary": "Get a task.",
        "operationId": "GetTask",
        "responses": {
          "200": {
            "description": "",
            "schema": {
              "$ref": "#/definitions/tesTask"
            }
          }
        },
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "tags": [
          "TaskService"
        ]
      }
    },
    "/v1/tasks/{id}:cancel": {
      "post": {
        "summary": "Cancel a task.",
        "operationId": "CancelTask",
        "responses": {
          "200": {
            "description": "",
            "schema": {
              "$ref": "#/definitions/tesCancelTaskResponse"
            }
          }
        },
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/tesCancelTaskRequest"
            }
          }
        ],
        "tags": [
          "TaskService"
        ]
      }
    }
  },
  "definitions": {
    "tesCancelTaskRequest": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Task identifier.\n\nREQUIRED."
        }
      },
      "description": "CancelTaskRequest describes a request to the CancelTask endpoint."
    },
    "tesCancelTaskResponse": {
      "type": "object",
      "description": "CancelTaskResponse describes a response from the CancelTask endpoint.\n\nOUTPUT ONLY."
    },
    "tesCreateTaskRequest": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "Task name.\n\nOPTIONAL."
        },
        "project": {
          "type": "string",
          "description": "Project task is associated with.\n\nCommonly used for billing on cloud providers (AWS, Google Cloud, etc).\n\nOPTIONAL."
        },
        "description": {
          "type": "string",
          "description": "OPTIONAL.",
          "title": "Task description"
        },
        "inputs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tesTaskParameter"
          },
          "description": "Inputs will be downloaded and mounted into the executor container.\n\nOPTIONAL.",
          "title": "Input files"
        },
        "outputs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tesTaskParameter"
          },
          "description": "Outputs will be uploaded from the executor container to long-term storage.\n\nOPTIONAL.",
          "title": "Output files"
        },
        "resources": {
          "$ref": "#/definitions/tesResources",
          "description": "Request that the task be run with these resources.\n\nOPTIONAL.",
          "title": "Requested resources"
        },
        "executors": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tesExecutor"
          },
          "description": "A list of executors to be run, sequentially.\n\nREQUIRED.",
          "title": "Executors"
        },
        "tags": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "A map of arbitrary tags.\n\nOPTIONAL."
        }
      },
      "description": "CreateTaskRequest describes a task to be created and run."
    },
    "tesExecutor": {
      "type": "object",
      "properties": {
        "image_name": {
          "type": "string",
          "description": "Name of the container image, for example:\nubuntu\nquay.io/aptible/ubuntu\ngcr.io/my-org/my-image\netc...\n\nREQUIRED."
        },
        "cmd": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "The command to be executed.\n\nREQUIRED."
        },
        "workdir": {
          "type": "string",
          "description": "The working directory that the command will be executed in.\nDefaults to the directory set by the container image.\n\nOPTIONAL."
        },
        "stdin": {
          "type": "string",
          "description": "Path inside the container to a file which will be piped\nto the command's stdin.\n\nOPTIONAL."
        },
        "stdout": {
          "type": "string",
          "description": "Path inside the container to a file where the command's\nstdout will be written to.\n\nOPTIONAL."
        },
        "stderr": {
          "type": "string",
          "description": "Path inside the container to a file where the command's\nstderr will be written to.\n\nOPTIONAL."
        },
        "ports": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tesPorts"
          },
          "description": "Port to expose from within the container, blank if none.\n\nOPTIONAL."
        },
        "environ": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Enviromental variables to set within the container.\n\nOPTIONAL."
        }
      },
      "description": "Executor describes a command to run, and its environment."
    },
    "tesExecutorLog": {
      "type": "object",
      "properties": {
        "start_time": {
          "type": "string",
          "description": "Time the executor started, in RFC 3339 format.\n\nOPTIONAL."
        },
        "end_time": {
          "type": "string",
          "description": "Time the executor ended, in RFC 3339 format.\n\nOPTIONAL."
        },
        "stdout": {
          "type": "string",
          "description": "Stdout tail.\nThis is not guaranteed to be the entire log.\nImplementations determine the maximum size.\n\nOPTIONAL."
        },
        "stderr": {
          "type": "string",
          "description": "Stderr tail.\nThis is not guaranteed to be the entire log.\nImplementations determine the maximum size.\n\nOPTIONAL."
        },
        "exit_code": {
          "type": "integer",
          "format": "int32",
          "description": "Exit code.\n\nREQUIRED."
        },
        "host_ip": {
          "type": "string",
          "description": "IP address of host.\n\nOPTIONAL."
        },
        "ports": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tesPorts"
          },
          "description": "Ports mapped between the container and host.\n\nOPTIONAL."
        }
      },
      "description": "ExecutorLog describes logging information related to an Executor.\n\nOUTPUT ONLY."
    },
    "tesFileType": {
      "type": "string",
      "enum": [
        "FILE",
        "DIRECTORY"
      ],
      "default": "FILE"
    },
    "tesGetTaskRequest": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Task identifier.\n\nREQUIRED."
        }
      },
      "description": "GetTaskRequest describes a request to the GetTask endpoint."
    },
    "tesListTasksRequest": {
      "type": "object",
      "properties": {
        "project": {
          "type": "string",
          "description": "Filter the task list to include tasks in this project.\n\nOPTIONAL."
        },
        "name_prefix": {
          "type": "string",
          "description": "Filter the list to include tasks where the name matches this prefix.\nIf unspecified, no task name filtering is done.\n\nOPTIONAL."
        },
        "page_size": {
          "type": "integer",
          "format": "int64",
          "description": "Number of tasks to return in one page.\nMust be less than 2048. Defaults to 256.\n\nOPTIONAL."
        },
        "page_token": {
          "type": "string",
          "description": "OPTIONAL.",
          "title": "Page token is used to retrieve the next page of results.\nIf unspecified, returns the first page of results.\nSee ListTasksResponse.next_page_token"
        }
      },
      "description": "ListTasksRequest describes a request to the ListTasks service endpoint."
    },
    "tesListTasksResponse": {
      "type": "object",
      "properties": {
        "tasks": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tesTaskDesc"
          },
          "description": "List of lightweight task descriptions.\n\nREQUIRED."
        },
        "next_page_token": {
          "type": "string",
          "description": "OPTIONAL.",
          "title": "Token used to return the next page of results.\nSee TaskListRequest.next_page_token"
        }
      },
      "description": "ListTasksResponse describes a response from the ListTasks endpoint.\n\nOUTPUT ONLY"
    },
    "tesOutputFileLog": {
      "type": "object",
      "properties": {
        "url": {
          "type": "string",
          "description": "REQUIRED.",
          "title": "URL of the file in storage, e.g. s3://bucket/file.txt"
        },
        "path": {
          "type": "string",
          "description": "Path of the file inside the container.\n\nREQUIRED."
        },
        "size_bytes": {
          "type": "string",
          "format": "int64",
          "description": "Size of the file in bytes.\n\nREQUIRED."
        }
      },
      "description": "OutputFileLog describes a single output file. This describes\nfile details after the task has completed successfully,\nfor logging purposes.\n\nOUTPUT ONLY."
    },
    "tesPorts": {
      "type": "object",
      "properties": {
        "container": {
          "type": "integer",
          "format": "int64",
          "description": "Port number opened inside the container.\n\nREQUIRED."
        },
        "host": {
          "type": "integer",
          "format": "int64",
          "description": "Port number opened on the host. Must be greater than 1024.\nDefaults to 0, which assigns a random port on the host.\n\nOPTIONAL."
        }
      },
      "description": "Ports describes the port mapping between the container and host."
    },
    "tesResources": {
      "type": "object",
      "properties": {
        "cpu_cores": {
          "type": "integer",
          "format": "int64",
          "description": "OPTIONAL.",
          "title": "Requested number of CPUs"
        },
        "preemptible": {
          "type": "boolean",
          "format": "boolean",
          "description": "OPTIONAL.",
          "title": "Is the task allowed to run on preemptible compute instances (e.g. AWS Spot)?"
        },
        "ram_gb": {
          "type": "number",
          "format": "double",
          "description": "OPTIONAL.",
          "title": "Requested RAM required in gigabytes (GB)"
        },
        "volumes": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tesVolume"
          },
          "description": "Volumes to be mounted into the container.\n\nOPTIONAL."
        },
        "zones": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Request that the task be run in these compute zones.\n\nOPTIONAL."
        }
      },
      "description": "Resources describes the resources requested by a task."
    },
    "tesServiceInfo": {
      "type": "object",
      "properties": {
        "storage_config": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "OPTIONAL.",
          "title": "System specific key/value pairs\nExample for a shared file system based storage system:\nstorageType=sharedFile, baseDir=/path/to/shared/directory"
        }
      },
      "description": "ServiceInfo describes information about the service,\nsuch as storage details, resource availability,\nand other documentation.\n\nOUTPUT ONLY."
    },
    "tesServiceInfoRequest": {
      "type": "object",
      "description": "ServiceInfoRequest describes a request to the ServiceInfo endpoint."
    },
    "tesState": {
      "type": "string",
      "enum": [
        "UNKNOWN",
        "QUEUED",
        "INITIALIZING",
        "RUNNING",
        "PAUSED",
        "COMPLETE",
        "ERROR",
        "SYSTEM_ERROR",
        "CANCELED"
      ],
      "default": "UNKNOWN",
      "description": "Task states.\n\nOUTPUT ONLY.\n\n - PAUSED: An implementation *may* have the ability to pause a task,\nbut this is not required."
    },
    "tesTask": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Task identifier.\n\nREQUIRED."
        },
        "metadata": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "REQUIRED."
        },
        "request": {
          "$ref": "#/definitions/tesCreateTaskRequest",
          "description": "REQUIRED."
        },
        "state": {
          "$ref": "#/definitions/tesState",
          "description": "REQUIRED."
        },
        "logs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tesTaskLog"
          },
          "description": "Task logging information.\nNormally, this will contain only one entry, but in the case where\na task fails and is retried, an entry will be appended to this list.\n\nREQUIRED."
        },
        "outputs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tesOutputFileLog"
          },
          "description": "Information about all output files. Directory outputs are\nflattened into separate items.\n\nREQUIRED."
        }
      },
      "description": "Task describes an instance of a task.\n\nOUTPUT ONLY.",
      "title": "Task"
    },
    "tesTaskDesc": {
      "type": "object",
      "properties": {
        "id": {
          "type": "string",
          "description": "Task identifier.\n\nREQUIRED."
        },
        "state": {
          "$ref": "#/definitions/tesState",
          "description": "REQUIRED."
        }
      },
      "description": "TaskDesc is a lightweight description of a task, which is returned\nby the ListTasks endpoint.\n\nOUTPUT ONLY"
    },
    "tesTaskLog": {
      "type": "object",
      "properties": {
        "logs": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/tesExecutorLog"
          },
          "description": "REQUIRED.",
          "title": "Logs for each executor"
        },
        "metadata": {
          "type": "object",
          "additionalProperties": {
            "type": "string"
          },
          "description": "Arbitrary logging metadata included by the implementation.\n\nOPTIONAL."
        },
        "start_time": {
          "type": "string",
          "description": "When the task started, in RFC 3339 format.\n\nREQUIRED."
        },
        "end_time": {
          "type": "string",
          "description": "When the task ended, in RFC 3339 format.\n\nREQUIRED."
        }
      },
      "description": "TaskLog describes logging information related to a Task.\n\nOUTPUT ONLY."
    },
    "tesTaskParameter": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "OPTIONAL."
        },
        "description": {
          "type": "string",
          "description": "OPTIONAL."
        },
        "url": {
          "type": "string",
          "description": "URL in long term storage, for example:\ns3://my-object-store/file1\ngs://my-bucket/file2\nfile:///path/to/my/file\n/path/to/my/file\netc...\n\nREQUIRED."
        },
        "path": {
          "type": "string",
          "description": "Path of the file inside the container.\n\nREQUIRED."
        },
        "type": {
          "$ref": "#/definitions/tesFileType",
          "description": "REQUIRED.",
          "title": "Type of the file, FILE or DIRECTORY"
        },
        "create": {
          "type": "boolean",
          "format": "boolean",
          "description": "If true, this path will be created before the task starts running.\nThis helps tasks create output directories which the task will\nwrite to.\n\nOPTIONAL."
        },
        "contents": {
          "type": "string",
          "description": "OPTIONAL.",
          "title": "File contents literal. \nImplementations should support a minimum of 128 KiB in this field and may define its own maximum.\nUTF-8 encoded"
        }
      },
      "description": "TaskParameter describes input and output files for a Task."
    },
    "tesVolume": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string",
          "description": "OPTIONAL."
        },
        "size_gb": {
          "type": "number",
          "format": "double",
          "description": "Requested disk size in gigabytes (GB).\n\nREQUIRED."
        },
        "mount_point": {
          "type": "string",
          "description": "Path inside the container that the volume will be mounted to.\n\nREQUIRED."
        }
      },
      "description": "Volume describes a volume (i.e. directory) which will be\nmounted into an executor/container."
    }
  }
}
